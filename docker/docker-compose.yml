services:
  tk-print:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: tk-print
    restart: unless-stopped
    # Use host network so container can reach printer on local network
    network_mode: host
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_URL=file:./data/tk-print.db
      # Redis on localhost since we're using host network
      - REDIS_URL=redis://127.0.0.1:6379
      # WooCommerce credentials (set via .env or environment)
      - WOOCOMMERCE_URL=${WOOCOMMERCE_URL}
      - WOOCOMMERCE_KEY=${WOOCOMMERCE_KEY}
      - WOOCOMMERCE_SECRET=${WOOCOMMERCE_SECRET}
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      # Printer settings (defaults, can be changed in dashboard)
      - PRINTER_IP=${PRINTER_IP:-192.168.1.100}
      - PRINTER_PORT=${PRINTER_PORT:-9100}
      # Store info (defaults, can be changed in dashboard)
      - STORE_NAME=${STORE_NAME:-My Store}
      - STORE_ADDRESS=${STORE_ADDRESS:-}
      - STORE_PHONE=${STORE_PHONE:-}
      - STORE_FOOTER=${STORE_FOOTER:-Thank you for your order!}
    volumes:
      - tk-print-data:/app/packages/api/data
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    container_name: tk-print-redis
    restart: unless-stopped
    # Expose redis port for tk-print (which uses host network)
    ports:
      - "127.0.0.1:6379:6379"
    volumes:
      - redis-data:/data
    command: redis-server --appendonly yes

volumes:
  tk-print-data:
  redis-data:
